<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitchutcha Docs</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* :root Variables and Global Styles */
        :root {
            --color-bg: #ffffff; --color-bg-inset: #f6f8fa; --color-border: #d0d7de; --color-text-primary: #1f2328; --color-text-secondary: #656d76; --color-accent: #0969da;
            --color-callout-note-bg: #ddf4ff; --color-callout-note-border: #96d3ff; --color-callout-warning-bg: #fff8c5; --color-callout-warning-border: #f4d35e;
            --header-height: 60px; --shadow-medium: 0 8px 24px rgba(140, 149, 159, 0.2);
        }
        html[data-theme="dark"] {
            --color-bg: #0d1117; --color-bg-inset: #161b22; --color-border: #30363d; --color-text-primary: #c9d1d9; --color-text-secondary: #8b949e; --color-accent: #58a6ff;
            --color-callout-note-bg: rgba(56, 139, 253, 0.15); --color-callout-note-border: #388bfd; --color-callout-warning-bg: rgba(240, 180, 5, 0.15); --color-callout-warning-border: #f0b405;
            --shadow-medium: 0 8px 24px rgba(1, 4, 9, 0.4);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--color-bg); color: var(--color-text-primary); line-height: 1.6; }
        .is-hidden { display: none !important; }

        /* General UI Structure */
        .container { display: flex; flex-direction: column; min-height: 100vh; }
        .main-wrapper { display: flex; flex-grow: 1; justify-content: center; }
        .header { display: flex; align-items: center; padding: 0 24px; height: var(--header-height); border-bottom: 1px solid var(--color-border); background-color: var(--color-bg-inset); position: sticky; top: 0; z-index: 200; }
        .logo { display: flex; align-items: center; gap: 8px; font-size: 1.2rem; font-weight: 600; color: var(--color-text-primary); text-decoration: none; }
        .logo svg { width: 32px; height: 32px; fill: currentColor; }
        .header-nav { margin-left: auto; display: flex; align-items: center; gap: 16px; }
        .theme-toggle { background: none; border: 1px solid var(--color-border); border-radius: 6px; cursor: pointer; padding: 6px; display: flex; color: var(--color-text-primary); }
        .theme-toggle svg { width: 16px; height: 16px; }
        .theme-toggle .icon-sun, .theme-toggle .icon-moon { display: none; }
        html[data-theme="light"] .theme-toggle .icon-moon { display: block; }
        html[data-theme="dark"] .theme-toggle .icon-sun { display: block; }

        /* Sidebar (Left Navigation) */
        .sidebar { width: 280px; flex-shrink: 0; border-right: 1px solid var(--color-border); padding: 24px; display: flex; flex-direction: column; height: calc(100vh - var(--header-height)); position: sticky; top: var(--header-height); background-color: var(--color-bg); }
        .sidebar-search input { width: 100%; padding: 8px 12px; font-size: 14px; border-radius: 6px; border: 1px solid var(--color-border); background-color: var(--color-bg-inset); color: var(--color-text-primary); margin-bottom: 16px; }
        .sidebar-nav { overflow-y: auto; flex-grow: 1; }
        .sidebar-nav ul { list-style: none; }
        .sidebar-nav .nav-category { font-size: 0.8rem; font-weight: 600; text-transform: uppercase; color: var(--color-text-secondary); margin: 24px 0 8px 0; }
        .sidebar-nav a { display: block; color: var(--color-text-primary); text-decoration: none; padding: 6px 12px; border-radius: 6px; font-size: 0.95rem; }
        .sidebar-nav a.active { background-color: var(--color-link-active-bg); color: var(--color-accent); font-weight: 600; }
        .no-results-message { color: var(--color-text-secondary); text-align: center; padding: 16px; }

        /* Main Content Area */
        .main-content { flex-grow: 1; padding: 24px 48px; max-width: 900px; }
        
        /* Landing Page Specific Styles */
        .landing-page { text-align: center; }
        .landing-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 16px; }
        .landing-subtitle { font-size: 1.25rem; color: var(--color-text-secondary); max-width: 600px; margin: 0 auto 48px; }
        .landing-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; text-align: left; }
        .card { background-color: var(--color-bg-inset); border: 1px solid var(--color-border); border-radius: 8px; padding: 24px; text-decoration: none; color: var(--color-text-primary); transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .card:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .card h3 { font-size: 1.1rem; margin-bottom: 8px; color: var(--color-accent); }
        .card p { font-size: 0.95rem; color: var(--color-text-secondary); }

        /* Article Content Styles */
        #content-area h1, #content-area h2, #content-area h3 { scroll-margin-top: calc(var(--header-height) + 16px); }
        #content-area img { max-width: 100%; border-radius: 6px; cursor: zoom-in; margin: 16px 0; }
        #article-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--color-border); font-size: 0.85rem; color: var(--color-text-secondary); }
        #article-meta a { color: var(--color-text-secondary); text-decoration: none; }
        
        /* Command Palette (Ctrl+K) */
        .command-palette-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
        .command-palette-results li.selected { background-color: var(--color-accent); color: white; }
        
        /* Image Lightbox */
        .lightbox-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; align-items: center; justify-content: center; cursor: zoom-out; }

        /* Print Styles */
        @media print {
            .header, .sidebar, .toc-sidebar, .article-navigation, .feedback-widget, #article-meta a, .copy-code-btn { display: none; }
            body { background-color: #fff; color: #000; }
            .main-wrapper, .main-content { display: block; padding: 0; max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <button class="hamburger-btn" id="hamburger-btn" aria-label="Abrir menu">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
            <a href="#" class="logo" id="logo-home-link">
                <svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                <span>Pitchutcha</span>
            </a>
            <nav class="header-nav" aria-label="Navegação principal">
                 <button class="theme-toggle" id="theme-toggle" aria-label="Alternar tema">
                    <svg class="icon-sun" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 010-1.414l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM3 11a1 1 0 100-2H2a1 1 0 100 2h1z"></path></svg>
                    <svg class="icon-moon" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                </button>
            </nav>
        </header>
        <div class="main-wrapper">
            <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-search">
                    <input type="text" id="search-input" placeholder="Filtrar tópicos...">
                </div>
                <nav class="sidebar-nav" id="sidebar-nav" aria-label="Navegação dos artigos">
                    <ul>
                        <li><div class="nav-category">Começando</div></li>
                        <li><a href="posts/introduction.md" class="nav-link">Introdução</a></li>
                        <li><a href="posts/getting-started.md" class="nav-link">Guia de Início Rápido</a></li>
                    </ul>
                    <ul>
                        <li><div class="nav-category">Guias</div></li>
                        <li><a href="posts/api-reference.md" class="nav-link">Referência da API</a></li>
                        <li><a href="posts/advanced-concepts.md" class="nav-link">Conceitos Avançados</a></li>
                    </ul>
                    <div class="no-results-message is-hidden" id="no-results">Nenhum resultado encontrado.</div>
                </nav>
            </aside>
            <main class="main-content">
                <div id="breadcrumbs"></div>
                <div id="article-meta" class="is-hidden">
                    <span id="last-updated"></span>
                    <a id="edit-on-github" href="#" target="_blank" rel="noopener noreferrer">Editar esta página no GitHub</a>
                </div>
                <div id="content-area"></div>
                <div id="article-navigation" class="article-navigation is-hidden"></div>
                <div id="feedback-widget" class="feedback-widget is-hidden"></div>
            </main>
            <aside class="toc-sidebar" id="toc-sidebar"></aside>
        </div>
    </div>

    <!-- Modals -->
    <div class="command-palette-overlay is-hidden" id="command-palette-overlay">
        <div class="command-palette" role="dialog" aria-modal="true" aria-labelledby="command-palette-label">
            <label id="command-palette-label" class="is-hidden">Paleta de Comandos</label>
            <input type="text" id="command-palette-input" placeholder="Escreva um comando ou pesquise...">
            <ul class="command-palette-results" id="command-palette-results" role="listbox"></ul>
        </div>
    </div>
    <div class="lightbox-overlay is-hidden" id="lightbox-overlay" role="dialog" aria-modal="true">
        <img src="" alt="Imagem ampliada">
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- State and Config ---
        const navLinks = Array.from(document.querySelectorAll('#sidebar-nav .nav-link'));
        const lastUpdatedDates = { /* ...datas aqui... */ };
        const GITHUB_BASE_URL = 'https://github.com/usuario/pitchutcha-docs/blob/main/';
        let lastFocusedElement;

        // --- UI Element Cache ---
        const ui = {
            contentArea: document.getElementById('content-area'),
            sidebar: document.getElementById('sidebar'),
            sidebarNav: document.getElementById('sidebar-nav'),
            logoHomeLink: document.getElementById('logo-home-link'),
            tocSidebar: document.getElementById('toc-sidebar'),
            breadcrumbs: document.getElementById('breadcrumbs'),
            articleMeta: document.getElementById('article-meta'),
            articleNavigation: document.getElementById('article-navigation'),
            feedbackWidget: document.getElementById('feedback-widget'),
            commandPalette: {
                overlay: document.getElementById('command-palette-overlay'),
                input: document.getElementById('command-palette-input'),
                results: document.getElementById('command-palette-results'),
            },
            lightbox: document.getElementById('lightbox-overlay'),
            hamburgerBtn: document.getElementById('hamburger-btn'),
            sidebarBackdrop: document.getElementById('sidebar-backdrop')
        };
        
        // --- Core Application Logic ---
        const navigateTo = (path) => {
            if (!path) {
                displayLandingPage();
                window.history.pushState({path: 'home'}, '', window.location.pathname);
            } else {
                loadContent(path);
                updateActiveLink(path);
                window.history.pushState({path}, '', `#${path}`);
            }
        };

        const loadContent = async (path) => {
            try {
                ui.contentArea.innerHTML = '<p>A carregar...</p>';
                const response = await fetch(path);
                if (!response.ok) throw new Error('Falha na rede');
                const markdown = await response.text();
                ui.contentArea.innerHTML = marked.parse(markdown);
                postRenderSetup(path);
            } catch (error) { ui.contentArea.innerHTML = `<h1>Erro ao Carregar</h1>`; }
        };

        const displayLandingPage = () => {
            ui.contentArea.innerHTML = `
                <div class="landing-page">
                    <h1 class="landing-title">Bem-vindo à Pitchutcha Docs</h1>
                    <p class="landing-subtitle">A sua central de conhecimento. Encontre guias, referências e tudo o que precisa.</p>
                    <div class="landing-cards">
                        <a href="posts/getting-started.md" class="card quick-link">
                            <h3>🚀 Guia de Início Rápido</h3> <p>Comece a sua jornada em minutos.</p>
                        </a>
                        <a href="posts/api-reference.md" class="card quick-link">
                            <h3>API Reference</h3> <p>Explore todos os endpoints da nossa API.</p>
                        </a>
                    </div>
                </div>`;
            ui.articleMeta.classList.add('is-hidden');
            ui.articleNavigation.classList.add('is-hidden');
            ui.feedbackWidget.classList.add('is-hidden');
            ui.tocSidebar.innerHTML = '';
            ui.breadcrumbs.innerHTML = '';
            updateActiveLink(null);
            ui.contentArea.querySelectorAll('.quick-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.getAttribute('href'));
                });
            });
        };

        const postRenderSetup = (path) => {
            ['articleMeta', 'articleNavigation', 'feedbackWidget'].forEach(el => ui[el].classList.remove('is-hidden'));
            generateArticleMeta(path);
            generatePrevNext(path);
            generateFeedbackWidget();
            ui.contentArea.querySelectorAll('img').forEach(img => img.addEventListener('click', () => openLightbox(img.src)));
            // ... Call other setup functions: callouts, copy buttons, toc, breadcrumbs...
        };

        // --- Feature Implementations (Refactored & Corrected) ---
        
        const generatePrevNext = (path) => {
            // BUG FIX: Always uses the original, unfiltered navLinks array.
            const currentIndex = navLinks.findIndex(link => link.getAttribute('href') === path);
            let prevHTML = '', nextHTML = '';
            if (currentIndex > 0) {
                const prevLink = navLinks[currentIndex - 1];
                prevHTML = `<a href="${prevLink.href}" class="prev"><div class="nav-label">Anterior</div><div class="nav-title">${prevLink.textContent}</div></a>`;
            }
            if (currentIndex < navLinks.length - 1) {
                const nextLink = navLinks[currentIndex + 1];
                nextHTML = `<a href="${nextLink.href}" class="next"><div class="nav-label">Próximo</div><div class="nav-title">${nextLink.textContent}</div></a>`;
            }
            ui.articleNavigation.innerHTML = prevHTML + nextHTML;
            ui.articleNavigation.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', e => { e.preventDefault(); navigateTo(link.getAttribute('href')); });
            });
        };
        
        const generateArticleMeta = (path) => {
            document.getElementById('edit-on-github').href = GITHUB_BASE_URL + path;
            const updatedDate = lastUpdatedDates[path] || new Date().toLocaleDateString('pt-PT');
            document.getElementById('last-updated').textContent = `Última atualização: ${updatedDate}`;
        };

        // Command Palette (Fully Implemented)
        const commandPaletteActions = [
            ...navLinks.map(link => ({
                title: link.textContent,
                category: link.closest('ul').querySelector('.nav-category').textContent,
                action: () => navigateTo(link.getAttribute('href'))
            })),
            { title: 'Alternar Tema Claro/Escuro', category: 'Ações', action: () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                setTheme(currentTheme === 'dark' ? 'light' : 'dark');
            }}
        ];

        const openCommandPalette = () => {
            lastFocusedElement = document.activeElement;
            ui.commandPalette.overlay.classList.remove('is-hidden');
            ui.commandPalette.input.focus();
            renderCommandPaletteResults('');
            trapFocus(ui.commandPalette.overlay);
        };

        const closeCommandPalette = () => {
            ui.commandPalette.overlay.classList.add('is-hidden');
            if (lastFocusedElement) lastFocusedElement.focus();
        };

        const renderCommandPaletteResults = (query) => {
            const results = commandPaletteActions.filter(item => item.title.toLowerCase().includes(query.toLowerCase()));
            ui.commandPalette.results.innerHTML = results.map(item =>
                `<li role="option" tabindex="-1" data-action-index="${commandPaletteActions.indexOf(item)}">
                    ${item.title} <small>${item.category}</small>
                </li>`
            ).join('');
        };
        
        // --- Accessibility: Focus Trapping ---
        const trapFocus = (element) => {
            const focusableEls = element.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])');
            const firstFocusableEl = focusableEls[0];
            const lastFocusableEl = focusableEls[focusableEls.length - 1];
            
            element.addEventListener('keydown', (e) => {
                if (e.key !== 'Tab') return;
                if (e.shiftKey) {
                    if (document.activeElement === firstFocusableEl) {
                        lastFocusableEl.focus();
                        e.preventDefault();
                    }
                } else {
                    if (document.activeElement === lastFocusableEl) {
                        firstFocusableEl.focus();
                        e.preventDefault();
                    }
                }
            });
        };

        // --- Event Listeners ---
        ui.logoHomeLink.addEventListener('click', (e) => { e.preventDefault(); navigateTo(null); });
        ui.sidebarNav.addEventListener('click', (e) => {
            if (e.target.matches('.nav-link')) { e.preventDefault(); navigateTo(e.target.getAttribute('href')); }
        });
        window.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); openCommandPalette(); }
            if (e.key === 'Escape') { closeCommandPalette(); /* closeLightbox(); */ }
        });
        ui.commandPalette.overlay.addEventListener('click', (e) => { if(e.target === ui.commandPalette.overlay) closeCommandPalette()});
        ui.commandPalette.input.addEventListener('input', () => renderCommandPaletteResults(ui.commandPalette.input.value));

        // --- Init ---
        navigateTo(window.location.hash.substring(1) || null);
    });
    </script>
</body>
</html>

